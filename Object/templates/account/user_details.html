{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load crispy_forms_tags %}
{% include 'partials/alerts.html' %}
<section class="text-gray-800 body-font bg-gradient-to-br from-purple-50 to-blue-50 py-16">
  <div class="container mx-auto px-5 flex flex-col items-center">
    <!-- Heading Section -->
    <div class="text-center mb-8">
      <h1 class="text-5xl font-bold text-gray-900 mb-2 leading-tight">
        User Details
      </h1>
      <p class="text-xl text-gray-600">Manage your profile and security settings.</p>
    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-3xl">
      <!-- Tab Navigation -->
      <div class="flex space-x-4 border-b border-gray-200 mb-6">
        <button id="profileTab"
          class="tab-button py-2 px-4 text-lg font-semibold text-gray-600 hover:text-gray-900 focus:outline-none transition-colors duration-200"
          onclick="switchTab('profile')">
          Own Profile
        </button>
        <button id="passwordTab"
          class="tab-button py-2 px-4 text-lg font-semibold text-gray-600 hover:text-gray-900 focus:outline-none transition-colors duration-200"
          onclick="switchTab('password')">
          Change Password
        </button>
      </div>

      <!-- Profile Tab Content -->
      <div id="profileContent" class="tab-content space-y-6">
        <h3 class="text-2xl font-bold text-gray-900 mb-4">Profile Information</h3>
        <div class="space-y-4">
          {% if not user.is_superuser %}
          <div>
            <label class="block font-semibold text-md text-gray-700">Full Name:</label>
            <p class="text-gray-900 font-semibold">{{ user.get_full_name }}</p>
          </div>
          {% endif %}
          {% if user.is_superuser %}
          <div>
            <p class="block font-semibold text-md text-gray-700">Super staff:
            <span class="text-gray-900 font-semibold">{{user.is_staff}}</span></p>
          </div>
          {% endif %}
          <div>
            <label class="block font-semibold text-md text-gray-700">Username:</label>
            <p class="text-gray-900 font-semibold">@{{ user.username }}</p>
          </div>
          <div>
            <label class="block font-semibold text-md text-gray-700">Account Created Date:</label>
            <span class="text-gray-900 font-semibold ">{{ user.date_joined }}</span>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Change Email</h3>
            <form method="POST" action="{% url 'user_details' %}">
              {% csrf_token %}
              <div class="space-y-4">
                {{ email_form|crispy }}
              </div>
              <button type="submit" name="change_email"
                class="w-full text-white bg-gradient-to-r from-blue-600 to-blue-700 border-0 py-3 px-8 focus:outline-none hover:from-blue-700 hover:to-blue-800 rounded-lg text-lg font-semibold shadow-lg transition-all duration-300 ease-in-out transform mt-6">
                Save Email Changes
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Password Tab Content -->
      <div id="passwordContent" class="tab-content hidden space-y-6">
        <h3 class="text-2xl font-bold text-gray-900 mb-4">Change Password</h3>
        <form method="POST" action="{% url 'user_details' %}">
          {% csrf_token %}
          <div class="space-y-4">
            {{ password_form|crispy }}
          </div>
          <button type="submit" name="change_password"
            class="w-full text-white bg-gradient-to-r from-blue-600 to-blue-700 border-0 py-3 px-8 focus:outline-none hover:from-blue-700 hover:to-blue-800 rounded-lg text-lg font-semibold shadow-lg transition-all duration-300 ease-in-out transform mt-6">
            Update Password
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  /* Active tab styling */
  .tab-button.active {
    color: #1a365d;
    border-bottom: 2px solid #1a365d;
  }

  /* Hidden tab content */
  .tab-content.hidden {
    display: none;
  }

  /* Form styling */
  .form-group {
    margin-bottom: 1rem;
  }

  .form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 0.375rem;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .form-control:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
</style>

<script>
  function switchTab(tabName) {
    // Hide all tab content
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.add('hidden');
    });

    // Remove active class from all tabs
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active');
    });

    // Show the selected tab content
    document.getElementById(`${tabName}Content`).classList.remove('hidden');

    // Add active class to the selected tab
    document.getElementById(`${tabName}Tab`).classList.add('active');
  }

  // Set the default tab based on the active tab passed from the server
  document.addEventListener('DOMContentLoaded', () => {
    const activeTab = '{{ active_tab }}';  // Get the active tab from the server context
    switchTab(activeTab);  // Switch to the active tab
  });
</script>
{% endblock %}