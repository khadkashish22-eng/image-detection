{% extends 'base.html' %}
{% block content %}
{% load static %}
{% include 'partials/alerts.html' %}
<section class="text-gray-800 body-font bg-gradient-to-br from-indigo-50 via-white to-blue-50 py-16">
  <div class="container mx-auto px-5">

    <!-- Heading -->
    <div class="text-center mb-14">
      <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-4 tracking-tight">
        Previous Predictions
      </h1>
      <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
        A history of your most recent scans ‚Äî beautifully organized for quick review.
      </p>
    </div>

    <!-- Table Card -->
    <div class="lg:w-4/5 w-full mx-auto overflow-hidden rounded-3xl shadow-2xl backdrop-blur-lg bg-white/70 ring-1 ring-gray-200">
      <table class="w-full text-left text-gray-800" id="predictionTable">
        <thead>
          <tr class="bg-gradient-to-r from-gray-100 to-gray-200 text-gray-900">
            <th class="px-6 py-4 text-lg font-semibold rounded-tl-3xl cursor-pointer" onclick="sortTable(event)">S.N</th>
            <th class="px-6 py-4 text-lg font-semibold">Image</th>
            <th class="px-6 py-4 text-lg font-semibold">Class A</th>
            <th class="px-6 py-4 text-lg font-semibold">Probability</th>
            <th class="px-6 py-4 text-lg font-semibold">Class B</th>
            <th class="px-6 py-4 text-lg font-semibold">Probability</th>
            <th class="px-6 py-4 text-lg font-semibold">Class C</th>
            <th class="px-6 py-4 text-lg font-semibold">Probability</th>
            <th class="px-6 py-4 text-lg font-semibold rounded-tr-3xl">Actions</th>
          </tr>
        </thead>
        <tbody id="predictionBody">
          {% if prediction %}
          {% for p in prediction %}
          <tr class="border-b border-gray-200 hover:bg-blue-50/60 transition-all duration-200 hover:shadow-sm">
            <td class="px-6 py-4 sn-col font-semibold text-gray-700">{{ forloop.counter }}</td>
            <td class="px-6 py-4">
              <div class="overflow-hidden rounded-xl shadow-sm w-16 h-16 flex items-center justify-center bg-white">
                <img src="{{ p.image_file.url }}" alt="Image"
                  class="w-full h-full object-cover rounded-lg transition-transform duration-300 hover:scale-110">
              </div>
            </td>
            <td class="px-6 py-4 font-medium">{{ p.class_1 }}</td>
            <td class="px-6 py-4 text-blue-600 font-semibold">{{ p.prob_1|floatformat:2 }}%</td>
            <td class="px-6 py-4 font-medium">{{ p.class_2 }}</td>
            <td class="px-6 py-4 text-green-600 font-semibold">{{ p.prob_2|floatformat:2 }}%</td>
            <td class="px-6 py-4 font-medium">{{ p.class_3 }}</td>
            <td class="px-6 py-4 text-purple-600 font-semibold">{{ p.prob_3|floatformat:2 }}%</td>
            <td class="px-6 py-4">
              <form method="POST" action="{% url 'delete_prediction' p.id %}">
                {% csrf_token %}
                <button type="submit"
                  class="px-4 py-2 text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="9" class="px-6 py-6 text-center text-gray-500 italic">No predictions found.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Buttons -->
    <div class="flex justify-center mt-10 space-x-6">
      <a href="{% url 'addpredict' %}"
        class="inline-flex items-center justify-center text-white bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-indigo-700 hover:to-blue-800 py-3 px-8 rounded-xl text-lg font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
        üîç Predict Again
      </a>
      <a href="{% url 'export_pdf' %}"
        class="inline-flex items-center justify-center text-white bg-gradient-to-r from-green-600 to-emerald-700 hover:from-emerald-700 hover:to-green-800 py-3 px-8 rounded-xl text-lg font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
        üìÑ Export to PDF
      </a>
    </div>
  </div>
</section>

<script>
  let sortAscending = true;
  function sortTable(event) {
    event.preventDefault();
    const tbody = document.getElementById("predictionBody");
    const rows = Array.from(tbody.getElementsByTagName("tr"));

    rows.sort((a, b) => {
      const snA = parseInt(a.querySelector(".sn-col")?.textContent || 0, 10);
      const snB = parseInt(b.querySelector(".sn-col")?.textContent || 0, 10);
      return sortAscending ? snA - snB : snB - snA;
    });

    tbody.innerHTML = "";
    rows.forEach(row => tbody.appendChild(row));
    sortAscending = !sortAscending;
  }
</script>
{% endblock %}
